{% extends "base.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock title %}

{% block header %}{{ header }}{% endblock header %}

{% block navigation%}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item active" aria-current="page">Главная</li>
        </ol>
    </nav>
{% endblock navigation %}

{% block content %}

<div class="container col-md-12 text-center">
    <a class="btn btn-primary" href="{% url 'home' theme='news' %}" role="button">Новости</a>
    <a class="btn btn-primary" href="{% url 'home' theme='start_event' %}" role="button">Стартовое событие</a>
    <a class="btn btn-primary" href="{% url 'home' theme='battle_event' %}" role="button">Боевое событие</a>
</div>

<div class="container text-center mt-4">
{% if theme == 'news' %}
    <h3>Новости</h3>
{% endif %}

{% if user.is_authenticated %}
    {% if theme == 'start_event' %}
    <h3>Награды за посещение мероприятия</h3>
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered mx-auto w-75">
            <thead class="thead-dark">
            <tr>
                <th scope="col" class="text-center">День</th>
                <th scope="col" class="text-center">Награда</th>
                <th scope="col" class="text-center">Статус</th>
            </tr>
            </thead>
            <tbody>
            {% for award in event_awards %}
            <tr>
                <td class="align-middle text-center">
                    {{ award.day_event_visit }}
                </td>
                <td class="align-middle">
                    {{ award.type_award }} {{ award.amount_or_rarity_award }}
                    {% if award.description %}
                    <br><small class="text-muted">({{ award.description }})</small>
                    {% endif %}
                </td>
                <td class="align-middle text-center">
                    {% if award.day_event_visit <= user_profile.event_visit %}
                    <span class="text-success">&#10004;</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% if button is True %}
    <div class="mt-4">
        <a href="{% url 'get_start_event_award' %}" class="btn btn-primary btn-lg">Отметиться</a>
    </div>
    {% endif %}
    {% endif %}

    {% if theme == 'battle_event' and day < 11 %}
    <h3>Боевое событие</h3>
    <div class="row mt-4">
        <div class="col-12 text-center">
            <h5 class="mb-3">День события: {{ day }} из 10</h5>
            <h5 class="mb-3">Заработанные очки: {{ points }}</h5>
        </div>
    </div>
    {% if team_user != None %}
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-5 text-center">
                <h4>Ваша команда</h4>
                <div class="row justify-content-around">
                    {% for card in team_user %}
                    <div class="col-4 mb-4 text-center">
                        <div class="team-user-card">
                            <img src="{{ card.class_card.image.url }}" alt="card-user-img"
                                 class="img-fluid rounded mb-2" style="max-width: 150px; height: auto;">
                            <h5><a href="{% url 'card' card_id=card.pk %}">{{ card.class_card.name }}</a></h5>
                            <div class="card-params text-left">
                                <p><strong>Здоровье:</strong> {{ card.hp }}</p>
                                <p><strong>Урон:</strong> {{ card.damage }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="col-md-1"></div>

            <div class="col-md-5 text-center">
                <h4>Команда противника <a href="{% url 'view_profile' user_id=enemy_user.user.pk %}">{{ enemy_user.user.username }}</a></h4>
                <div class="row justify-content-around">
                    {% for card in team_enemy %}
                    <div class="col-4 mb-4 text-center">
                        <div class="team-enemy-card">
                            <img src="{{ card.class_card.image.url }}" alt="card-enemy-img"
                                 class="img-fluid rounded mb-2" style="max-width: 150px; height: auto;">
                            <h5><a href="{% url 'card' card_id=card.pk %}">{{ card.class_card.name }}</a></h5>
                            <div class="card-params text-left">
                                <p><strong>Здоровье:</strong> {{ card.hp }}</p>
                                <p><strong>Урон:</strong> {{ card.damage }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% if can_fight %}
        <div class="row">
            <div class="col-12 text-center">
                <a href="{% url 'fight_day_battle_event' enemy_id=enemy_user.user.pk %}" class="btn btn-primary">Атака</a>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="row mt-5">
        <div class="col-md-8 mx-auto">
            <hr class="my-4">
            <h4>Таблица Лидеров</h4>
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th scope="col">Место</th>
                    <th scope="col">Пользователь</th>
                    <th scope="col">Очки</th>
                    <th scope="col">Награда (diamond)</th>
                </tr>
                </thead>
                <tbody>
                {% for rank in rating %}
                <tr>
                    <td>{{ rank.0 }}</td>
                    {% if rank.1 != None %}
                        <td>{{ rank.1 }}</td>
                        <td>{{ rank.2 }}</td>
                    {% else %}
                        <td> - </td>
                        <td> - </td>
                    {% endif %}
                    <td>{{ rank.3 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3">Пока нет участников с очками для рейтинга.</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% if theme == 'battle_event' and day > 10 %}
    <div class="row justify-content-center">
        <h4>Ваш отряд</h4>
        <div class="row justify-content-center align-items-center">
            {% for card in user_team_template %}
            {% if card is not None %}
            <div class="col-3 mb-4 text-center">
                <div class="team-enemy-card">
                    <img src="{{ card.class_card.image.url }}" alt="card-img"
                         class="img-fluid rounded mb-3 mx-auto d-block" style="max-width: 200px; height: auto;">
                    <h5><a href="{% url 'card' card_id=card.pk %}">{{ card.class_card.name }}</a></h5>
                    <div class="card-params text-left">
                        <p><strong>Редкость:</strong> {{ card.rarity.name }}</p>
                        <p><strong>Уровень:</strong> {{ card.level }}</p>
                        <p><strong>Здоровье:</strong> {{ card.hp }}</p>
                        <p><strong>Урон:</strong> {{ card.damage }}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 text-center">
                        <a href="{% url 'be_team_menu' place=forloop.counter %}" class="btn btn-primary">Заменить</a>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-3 mb-4 text-center">
                <div class="team-enemy-card">
                    <img src="{% static 'battle_event/card/default.png' %}" alt="card-img"
                         class="img-fluid rounded mb-3 mx-auto d-block" style="max-width: 200px; height: auto;">
                    <h5>Неизвестно</h5>
                    <div class="card-params text-left">
                        <p><strong>Редкость:</strong> ???</p>
                        <p><strong>Уровень:</strong> ???</p>
                        <p><strong>Здоровье:</strong> ???</p>
                        <p><strong>Урон:</strong> ???</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 text-center">
                        <a href="{% url 'be_team_menu' place=forloop.counter %}" class="btn btn-primary">Добавить</a>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
<br>
{% endif %}
{% endblock content %}